namespace = gnt_tax

gnt_tax.0001 = {
    type = character_event
    title = gnt_tax.0001.t
    desc = gnt_tax.0001.d
    theme = realm

    left_portrait = {
        character = root
        animation = personality_rational
    }

    lower_right_portrait = {
        character = scope:your_liege
    }

    trigger = {
        exists = liege
        liege != root
	    is_available_quick = {
		    imprisoned = no
	    }
        is_at_war_with_liege = no
        OR = {
            is_ai = yes
            is_ai = no
        }
    }

    immediate = {
        liege = {
            save_scope_as = your_liege
        }
    }

    option = { ##########################pay tax
        name = gnt_tax.0001.a
        trigger = {
            gold >= {
                value = { add = gnt_yearly_tax_value }
            }
        }
        show_as_unavailable = {
            gold < {
                value = { add = gnt_yearly_tax_value }
            }
        }
        remove_short_term_gold = {
            gold = {
                value = { add = gnt_yearly_tax_value }
            }
        }
        scope:your_liege = {
            send_interface_message = {
                type = msg_gnt_tax_pay
                title = msg_gnt_tax_pay_title
                desc = msg_gnt_tax_pay_desc
                left_icon = root
                add_gold = {
                    gold = {
                        value = { add = gnt_yearly_tax_value }
                    }
                }
            }
        }

		ai_chance = {
			base = 8
		    modifier = {
			    add = 5
                has_trait = content
			}
		    modifier = {
			    add = -5
	            opinion = {
		            target = scope:your_liege
		            value <= 0
                }
			}
		    modifier = {
			    add = 5
	            opinion = {
		            target = scope:your_liege
		            value >= 15
                }
			}
		    modifier = {
			    add = 5
	            opinion = {
		            target = scope:your_liege
		            value >= 50
                }
			}
		}
    }


    option = {###########################half
        name = gnt_tax.0001.b
		trigger = {
            OR = {
			    diplomacy >= 16
                stewardship >= 16
            }
            gold >= {
                value = { add = gnt_yearly_tax_half }
            }
		}
        show_as_unavailable = {
            gold < {
                value = { add = gnt_yearly_tax_half }
            }
        }
        remove_short_term_gold = {
            gold = {
                value = { add = gnt_yearly_tax_half }
            }
        }
        stress_impact = {
            generous = minor_stress_gain
            greedy = minor_stress_loss
        }
        scope:your_liege = {
            add_opinion = {
			    modifier = upset_opinion
                opinion = -5
			    target = root
		    }
            send_interface_message = {
                type = msg_gnt_tax_half
                title = msg_gnt_tax_half_title
                desc = msg_gnt_tax_half_desc
                left_icon = root
                add_gold = {
                    gold = {
                        value = { add = gnt_yearly_tax_half }
                    }
                }
            }
        }

		ai_chance = {
			base = 10
		    modifier = {
			    add = 5
			    OR = {
                    diplomacy >= 16
                    stewardship >= 16
				}
			}
		    modifier = {
			    add = 10
	            opinion = {
		            target = scope:your_liege
		            value < 30
                }
			}
		}
    }

    option = {###########################relation
        name = gnt_tax.0001.c
		trigger = {
            OR = {
				has_secret_relation_lover = scope:your_liege
				has_relation_lover = scope:your_liege
				has_relation_soulmate = scope:your_liege
				has_relation_friend = scope:your_liege
				has_relation_best_friend = scope:your_liege
            }
		}
        stress_impact = {
            generous = minor_stress_gain
            greedy = minor_stress_loss
            shy = minor_stress_gain
        }
        scope:your_liege = {
            send_interface_message = {
                type = msg_gnt_tax_relation
                title = msg_gnt_tax_relation_title
                desc = msg_gnt_tax_relation_desc
                left_icon = root
            }
        }

		ai_chance = {
			base = 10
		    modifier = {
			    add = 10
			    OR = {
					has_secret_relation_lover = scope:your_liege
					has_relation_lover = scope:your_liege
					has_relation_soulmate = scope:your_liege
					has_relation_friend = scope:your_liege
					has_relation_best_friend = scope:your_liege
				}
			}
		}
    }

    option = {###########################more tax
        name = gnt_tax.0001.double
        trigger = {
            gold >= {
                value = { add = gnt_yearly_tax_double }
            }
        }
        show_as_unavailable = {
            gold < {
                value = { add = gnt_yearly_tax_double }
            }
        }
        remove_short_term_gold = {
            gold = {
                value = { add = gnt_yearly_tax_double }
            }
        }
        stress_impact = {
            generous = minor_stress_loss
            greedy = medium_stress_gain
        }
        scope:your_liege = {
            add_opinion = {
			    modifier = pleased_opinion
                opinion = 15
			    target = root
		    }
            send_interface_message = {
                type = msg_gnt_tax_double
                title = msg_gnt_tax_double_title
                desc = msg_gnt_tax_double_desc
                left_icon = root
                add_gold = {
                    gold = {
                        value = { add = gnt_yearly_tax_double }
                    }
                }
            }
        }

        ai_chance = {
			base = 0
		    modifier = {
			    add = 10
                OR = {
					has_secret_relation_lover = scope:your_liege
					has_relation_lover = scope:your_liege
					has_relation_soulmate = scope:your_liege
					has_relation_friend = scope:your_liege
					has_relation_best_friend = scope:your_liege
                    has_relation_crush = scope:your_liege
                }
            }
		    modifier = {
			    add = 5
	            opinion = {
		            target = scope:your_liege
		            value >= 50
                }
            }
		    modifier = {
			    add = 5
                has_trait = generous
            }
		}
    }

    option = {###########################no money
        name = gnt_tax.0001.e
        if = {
            limit = {
                AND = {
                    scope:your_liege = {
	                    opinion = {
		                    target = root
		                    value <= -50
                        }
                    }
                    is_ai = no
                }
            }
            scope:your_liege = {
                imprison = { target = root }
            }
        }
        scope:your_liege = {
            add_opinion = {
			    modifier = upset_opinion
                opinion = -15
			    target = root
		    }
            send_interface_message = {
                type = msg_gnt_tax_no
                title = msg_gnt_tax_no_title
                desc = msg_gnt_tax_no_desc
                left_icon = root
            }
        }
        add_prestige = minor_prestige_loss
        stress_impact = {
            generous = medium_stress_gain
            greedy = medium_stress_loss
            craven = minor_stress_gain
        }

        ai_chance = {
			base = 10
		    modifier = {
			    add = 10
                OR = {
                    has_relation_rival = scope:your_liege
                    has_relation_grudge = scope:your_liege
                    has_relation_nemesis = scope:your_liege
                    has_relation_bully = scope:your_liege
	                opinion = {
		                target = scope:your_liege
		                value <= -15
                    }
                }
            }
		    modifier = {
			    add = -5
	            opinion = {
		            target = scope:your_liege
		            value >= 30
                }
            }
		    modifier = {
			    add = 5
                has_trait = greedy
            }
		}
    }
}